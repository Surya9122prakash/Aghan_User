<!DOCTYPE html>
<html lang="zxx">

<head>
   <meta charset="utf-8" />
   <meta http-equiv="x-ua-compatible" content="IE=edge" />
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="Aghan Promoters" />
   <meta name="keyword" content="Aghan Promoters" />
   <meta name="author" content="Aghan Promoters" />
   <title>Tree View - Aghan Promoters</title>
   <link rel="shortcut icon" type="image/x-icon" href="assets/images/Dashboard/logo.png" />
   <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css" />
   <link rel="stylesheet" type="text/css" href="assets/vendors/css/vendors.min.css" />
   <link rel="stylesheet" type="text/css" href="assets/vendors/css/daterangepicker.min.css" />
   <link rel="stylesheet" type="text/css" href="assets/css/theme.min.css" />
   <link rel="stylesheet" href="assets/css/tree.css">
   <style>
      /* Common styles for genealogy.html and viewtree.html - place inside <style> tags */
      body {
         background-color: #182c25;
      }
   </style>
   <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
</head>

<body>
   <nav class="nxl-navigation">
      <div class="navbar-wrapper">
         <div class="m-header">
            <a href="user.html" class="b-brand">
               <img src="assets/images/Dashboard/aghan-logo-english.png" width="100" alt="Aghan Logo"
                  class="logo logo-lg" />
               <img src="assets/images/Dashboard/logo.png" alt="Aghan logo" class="logo logo-sm" />
            </a>
         </div>
         <div class="navbar-content">
            <ul class="nxl-navbar">
               <li class="nxl-item">
                  <a href="user.html" class="nxl-link">
                     <span class="nxl-micon"><i class="feather-grid"></i></span>
                     <span class="nxl-mtext"><b>Dashboard</b></span>
                  </a>
               </li>

               <li class="nxl-item">
                  <a href="./assets/images/Brochure PDF/aghan brochure pdf.pdf" class="nxl-link"
                     download="aghan brochure pdf.pdf">
                     <span class="nxl-micon"><i class="feather-download"></i></span>
                     <span class="nxl-mtext"><b>Download Brochure</b></span>
                  </a>
               </li>

               <li class="nxl-item">
                  <a href="user register.html" class="nxl-link">
                     <span class="nxl-micon"><i class="feather-user-plus"></i></span>
                     <span class="nxl-mtext"><b>Register</b></span>
                  </a>
               </li>

               <li class="nxl-item nxl-hasmenu">
                  <a href="javascript:void(0);" class="nxl-link">
                     <span class="nxl-micon"><i class="fas fa-user-check"></i></span>
                     <span class="nxl-mtext"><b>Activation</b></span><span class="nxl-arrow"><i
                           class="feather-chevron-right"></i></span>
                  </a>
                  <ul class="nxl-submenu">
                     <li class="nxl-item"><a class="nxl-link" href="add funds.html">Add Funds</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="topup.html">User Topup</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="history.html">History</a></li>
                  </ul>
               </li>


               <li class="nxl-item nxl-hasmenu active nxl-trigger">
                  <a href="javascript:void(0);" class="nxl-link">
                     <span class="nxl-micon"> <span class="material-symbols-outlined">account_tree</span></span>
                     <span class="nxl-mtext">Tree View</span><span class="nxl-arrow"><i
                           class="feather-chevron-right"></i></span>
                  </a>
                  <ul class="nxl-submenu">
                     <li class="nxl-item"><a class="nxl-link" href="my direct.html">My Direct</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="my team.html">My Team</a></li>
                     <li class="nxl-item active"><a class="nxl-link" href="Tree View.html">Tree View</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="silver board.html">Silver Board</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="gold board.html">Gold Board</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="diamond board.html">Diamond Board</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="platinum board.html">Platinum Board</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="king board.html">King Board</a></li>
                  </ul>
               </li>
               <li class="nxl-item nxl-hasmenu">
                  <a href="javascript:void(0);" class="nxl-link">
                     <span class="nxl-micon"><i class="fas fa-exchange-alt"></i></span>
                     <span class="nxl-mtext">Transactions</span><span class="nxl-arrow"><i
                           class="feather-chevron-right"></i></span>
                  </a>
                  <ul class="nxl-submenu">
                     <li class="nxl-item"><a class="nxl-link" href="fund transfer.html">Fund Transfer</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="internal transfer.html">Internal Transfer</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="AW to EW transfer.html">AW to EW Transfer</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="EW to UW transfer.html">EW to UW Transfer</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="accounts.html">Accounts</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="transaction.html">All Transactions</a></li>
                  </ul>
               </li>
               <li class="nxl-item nxl-hasmenu">
                  <a href="javascript:void(0);" class="nxl-link">
                     <span class="nxl-micon"><i class="fas fa-wallet"></i></span>
                     <span class="nxl-mtext">Income</span><span class="nxl-arrow"><i
                           class="feather-chevron-right"></i></span>
                  </a>
                  <ul class="nxl-submenu">
                     <li class="nxl-item"><a class="nxl-link" href="sponser income.html">Sponser Income</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="silver board income.html">Silver Board Income</a>
                     </li>
                     <li class="nxl-item"><a class="nxl-link" href="gold board income.html">Gold Board Income</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="diamond board income.html">Diamond Board Income</a>
                     </li>
                     <li class="nxl-item"><a class="nxl-link" href="platinum board income.html">Platinum Board
                           Income</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="king board income.html">King Board Income</a></li>
                  </ul>
               </li>

               <li class="nxl-item">
                  <a href="withdraw.html" class="nxl-link">
                     <span class="nxl-micon"><i class="fas fa-money-bill-wave"></i></span>
                     <span class="nxl-mtext"><b>Withdraw</b></span>
                  </a>
               </li>

               <li class="nxl-item">
                  <a href="refer friends.html" class="nxl-link">
                     <span class="nxl-micon"><i class="feather-user-plus"></i></span>
                     <span class="nxl-mtext"><b>Invite Friends</b></span>
                  </a>
               </li>

               <li class="nxl-item nxl-hasmenu">
                  <a href="javascript:void(0);" class="nxl-link">
                     <span class="nxl-micon"><i class="fas fa-user-cog"></i></span>
                     <span class="nxl-mtext"><b>My Profile</b></span><span class="nxl-arrow"><i
                           class="feather-chevron-right"></i></span>
                  </a>
                  <ul class="nxl-submenu">
                     <li class="nxl-item"><a class="nxl-link" href="personal.html">Personal</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="change password.html">Change Password</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="bank update.html">Bank Update</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="upi update.html">UPI Update</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="profile image.html">Profile Image</a></li>
                  </ul>
               </li>

               <li class="nxl-item nxl-hasmenu">
                  <a href="javascript:void(0);" class="nxl-link">
                     <span class="nxl-micon"><i class="fas fa-life-ring"></i></span>
                     <span class="nxl-mtext">Help</span><span class="nxl-arrow"><i
                           class="feather-chevron-right"></i></span>
                  </a>
                  <ul class="nxl-submenu">
                     <li class="nxl-item"><a class="nxl-link" href="create tickets.html">Create Tickets</a></li>
                     <li class="nxl-item"><a class="nxl-link" href="view tickets.html">View Tickets</a></li>
                  </ul>
               </li>

               <li class="nxl-item">
                  <a href="index.html" class="nxl-link">
                     <span class="nxl-micon"><i class="fas fa-sign-out-alt"></i></span>
                     <span class="nxl-mtext"><b>Sign Out</b></span>
                  </a>
               </li>
            </ul>
         </div>
      </div>
   </nav>
   <header class="nxl-header">
      <div class="header-wrapper">
         <div class="header-left d-flex align-items-center gap-4">
            <a href="javascript:void(0);" class="nxl-head-mobile-toggler" id="mobile-collapse">
               <div class="hamburger hamburger--arrowturn">
                  <div class="hamburger-box">
                     <div class="hamburger-inner"></div>
                  </div>
               </div>
            </a>
            <div class="nxl-navigation-toggle">
               <a href="javascript:void(0);" id="menu-mini-button">
                  <i class="feather-align-left"></i>
               </a>
               <a href="javascript:void(0);" id="menu-expend-button" style="display: none">
                  <i class="feather-arrow-right"></i>
               </a>
            </div>
         </div>
         <div class="header-right ms-auto">
            <div class="d-flex align-items-center">
               <div class="dropdown nxl-h-item nxl-header-language d-none d-sm-flex">
                  <a href="javascript:void(0);" class="nxl-head-link me-0 nxl-language-link" data-bs-toggle="dropdown"
                     data-bs-auto-close="outside">
                     <img src="assets/vendors/img/flags/1x1/in.svg" alt="" class="img-fluid wd-20" />
                  </a>
                  <div class="dropdown-menu dropdown-menu-end nxl-h-dropdown nxl-language-dropdown">
                     <div class="dropdown-divider mt-0"></div>
                     <div class="language-items-wrapper">
                        <div class="select-language px-4 py-2 hstack justify-content-between gap-4">
                           <div class="lh-lg">
                              <h6 class="mb-0">Select Language</h6>
                              <p class="fs-11 text-muted mb-0">12 languages avaiable!</p>
                           </div>
                           <a href="javascript:void(0);" class="avatar-text avatar-md" data-bs-toggle="tooltip"
                              title="Add Language">
                              <i class="feather-plus"></i>
                           </a>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="row px-4 pt-3">
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/sa.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>Arabic</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/bd.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>Bengali</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/ch.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>Chinese</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/nl.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>Dutch</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select active">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/us.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>English</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/fr.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>French</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/de.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>German</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/in.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>Tamil</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/ru.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>Russian</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/es.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>Spanish</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/tr.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>Turkish</span>
                              </a>
                           </div>
                           <div class="col-sm-4 col-6 language_select">
                              <a href="javascript:void(0);" class="d-flex align-items-center gap-2">
                                 <div class="avatar-image avatar-sm"><img src="assets/vendors/img/flags/1x1/pk.svg"
                                       alt="" class="img-fluid" /></div>
                                 <span>Urdo</span>
                              </a>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="nxl-h-item d-none d-sm-flex">
                  <div class="full-screen-switcher">
                     <a href="javascript:void(0);" class="nxl-head-link me-0"
                        onclick="$('body').fullScreenHelper('toggle');">
                        <i class="feather-maximize maximize"></i>
                        <i class="feather-minimize minimize"></i>
                     </a>
                  </div>
               </div>
               <div class="nxl-h-item dark-light-theme">
                  <a href="javascript:void(0);" class="nxl-head-link me-0 dark-button">
                     <i class="feather-moon"></i>
                  </a>
                  <a href="javascript:void(0);" class="nxl-head-link me-0 light-button" style="display: none">
                     <i class="feather-sun"></i>
                  </a>
               </div>
               <div class="dropdown nxl-h-item">
                  <a href="javascript:void(0);" data-bs-toggle="dropdown" role="button" data-bs-auto-close="outside">
                     <img src="assets/images/Dashboard/logo.png" alt="user-image" class="img-fluid user-avtar me-0" />
                  </a>
                  <div class="dropdown-menu dropdown-menu-end nxl-h-dropdown nxl-user-dropdown">
                     <div class="dropdown-header">
                        <div class="d-flex align-items-center">
                           <img src="assets/images/Dashboard/logo.png" alt="user-image" class="img-fluid user-avtar" />
                           <div>
                              <h6 class="text-dark mb-0">Aghan <span
                                    class="badge bg-soft-success text-success ms-1"></span></h6>
                              <span class="fs-12 fw-medium text-muted">infoaghan@gmail.com</span>
                           </div>
                        </div>
                     </div>

                     <a href="javascript:void(0);" class="dropdown-item">
                        <i class="feather-settings"></i>
                        <span>Account Settings</span>
                     </a>
                     <div class="dropdown-divider"></div>
                     <a href="index.html" class="dropdown-item">
                        <i class="feather-log-out"></i>
                        <span>Logout</span>
                     </a>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </header>
   <style>
      .card {
         background-color: #005627 !important;
      }

      .table>:not(caption)>*>* {
         background-color: #005627 !important;
         color: #fff;
      }

      @media only screen and (max-width: 420px) {
         .tree.fourmatrix ul.first_level_mem>li>a {
            width: 200px !important;
         }
      }

      .tree ul.second_level_mem>li>a {
         width: 80px !important;
      }

      .tree li a:hover .mem_info {
         display: block;
      }
   </style>

   <main class="nxl-container">
      <div class="nxl-content">
         <div class="main-content">
            <div class="row">
               <div class="col-sm-12 col-xl-12 d-flex justify-content-center align-items-center">
                  <div class="card">
                     <div class="card-inner">
                        <div class="card-inner">
                           <div class="tree fourmatrix" style="height: 1000px;">
                              <ul id="treeContainer"> </ul>
                           </div>
                           <div id="error-container"></div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </main>

   <script src="assets/vendors/js/vendors.min.js"></script>
   <script src="assets/vendors/js/daterangepicker.min.js"></script>
   <script src="assets/vendors/js/apexcharts.min.js"></script>
   <script src="assets/vendors/js/circle-progress.min.js"></script>
   <script src="assets/js/common-init.min.js"></script>
   <script src="assets/js/dashboard-init.min.js"></script>
   <script src="assets/js/theme-customizer-init.min.js"></script>
   <script>
      document.addEventListener('DOMContentLoaded', () => {
         const urlParams = new URLSearchParams(window.location.search);
         const userId = urlParams.get('id');

         if (!userId) {
            displayErrorMessage("User ID is required to view the tree.");
            return;
         }

         fetchGenealogyData(userId);
      });

      function getAuthToken() {
         return sessionStorage.getItem('token1');
      }

      async function fetchGenealogyData(userId) {
         try {
            const response = await fetch(`https://aghan-backend.onrender.com/tree/${userId}`, {
               headers: {
                  'Authorization': 'Bearer ' + getAuthToken()
               }
            });

            if (!response.ok) {
               const errorData = await response.json();
               const errorMessage = errorData.message || `HTTP error! Status: ${response.status}`;
               throw new Error(errorMessage);
            }

            const data = await response.json();
            renderGenealogyTree(data.genealogyTree);
         } catch (error) {
            console.error('Error fetching genealogy data:', error);
            displayErrorMessage(error.message);
         }
      }

      function renderGenealogyTree(treeData) {
         const treeContainer = document.getElementById('treeContainer');
         treeContainer.innerHTML = ''; // Clear previous content

         function createNodeElement(node) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            const img = document.createElement('img');
            const userInfo = document.createElement('div');
            const memInfo = document.createElement('div');

            img.src = 'assets/images/Dashboard/avatar.png';
            img.className = 'img-80 img-radius';
            userInfo.className = 'tree3_uinfo';
            userInfo.innerHTML = `${node.user_id}<br>${node.referrer_id || ''}`; //handle null referrer_id

            a.appendChild(img);
            a.appendChild(userInfo);

            // Apply active/inactive styles
            a.classList.add(node.status === 'Active' ? 'active-member' : 'inactive-member');

            if (node.status === 'Active') { // Only add memInfo for active members and make it hoverable
               memInfo.className = 'mem_info';
               memInfo.innerHTML = `<table>
                       <tr><th>Name:</th><td>${node.username}</td></tr>
                         <tr><th>ID:</th><td>${node.user_id}</td></tr>
                         <tr><th>Parent:</th><td>${node.referrer_id || ''}</td></tr>
                         <tr><th>L1 Count:</th><td>${node['L1 Count'] || 0}</td></tr>
                         <tr><th>L2 Count:</th><td>${node['L2 Count'] || 0}</td></tr>
                         <tr><th>L3 Count:</th><td>${node['L3 Count'] || 0}</td></tr>
                         <tr><th>L4 Count:</th><td>${node['L4 Count'] || 0}</td></tr>
                         <tr><th>L5 Count:</th><td>${node['L5 Count'] || 0}</td></tr>
                         <tr><th>Total:</th><td>${node['Total'] || 0}</td></tr>
                       </table>`;
               a.appendChild(memInfo);
            }

            li.appendChild(a);
            const totalSlots = 6; // Adjust as needed
            let existingChildren = node.children || [];

            if (node.level !== undefined && node.level < 2) { // Limit levels for placeholders (adjust as needed)
               const ul = document.createElement('ul');
               if (node.level === 0) ul.classList.add('first_level_mem');
               else ul.classList.add('second_level_mem');

               // Add existing children
               existingChildren.forEach(child => {
                  ul.appendChild(createNodeElement(child));
               });

               // Add placeholders for missing children (inactive)
               for (let i = existingChildren.length; i < totalSlots; i++) {
                  const placeholderNode = {
                     user_id: 'Inactive',
                     username: 'Inactive',
                     referrer_id: null,
                     status: 'Inactive',
                     level: node.level + 1,
                     children: []
                  };
                  ul.appendChild(createNodeElement(placeholderNode));
               }
               li.appendChild(ul);
            }

            return li;
         }

         treeContainer.appendChild(createNodeElement(treeData));
      }

      async function fetchUserDetails() {
         //This function is not directly used in viewtree.html but kept here for completeness if needed later
         try {
            const token = sessionStorage.getItem('token1');
            const response = await fetch('https://aghan-backend.onrender.com/user', {
               headers: {
                  'Authorization': 'Bearer ' + token
               }
            });

            if (!response.ok) {
               const errorData = await response.json();
               const errorMessage = errorData.message || `HTTP error! Status: ${response.status}`;
               throw new Error(errorMessage);
            }

            const data = await response.json();
            return {
               userId: data.user.user_id,
               role: data.user.role
            };
         } catch (error) {
            console.error('Error fetching user details:', error);
            throw error;
         }
      }

      function displayErrorMessage(message) {
         const errorContainer = document.getElementById('error-container');
         if (errorContainer) {
            errorContainer.innerHTML = `<div class="alert alert-danger">${message}</div>`;
         }
      }
   </script>
</body>

<style>
   /* Styles for active and inactive members */
   .tree li a.active-member {
      border: 2px solid #28a745;
      /* Green border for active members */
      background-color: rgba(40, 167, 69, 0.1);
      /* Light green background */
   }

   .tree li a.inactive-member {
      border: 2px solid #6c757d;
      /* Gray border for inactive/vacant members */
      background-color: rgba(108, 117, 125, 0.1);
      /* Light gray background */
      opacity: 0.6;
   }

   .tree li a.inactive-member .tree3_uinfo {
      color: #6c757d;
   }

   .tree li a .mem_info {
      display: none;
      position: absolute;
      z-index: 10;
      background-color: #005627;
      color: white;
      border: 1px solid #28a745;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 250px;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
   }

   .tree li a:hover .mem_info {
      display: block;
   }

   .tree li a .mem_info table {
      width: 100%;
   }

   .tree li a .mem_info table th {
      text-align: left;
      padding-right: 10px;
      width: 40%;
   }

   .tree li a .mem_info table td {
      text-align: left;
   }
</style>

</html>